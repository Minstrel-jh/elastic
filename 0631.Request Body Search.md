# 请求体查询

## Doc value Fields

示例：

```json
GET /_search
{
    "query" : {
        "match_all": {}
    },
    "docvalue_fields" : [
        "my_ip_field",
        {
            "field": "my_keyword_field"
        },
        {
            "field": "my_date_field",
            "format": "epoch_millis"
        }
    ]
}
```

支持时间和数值的格式化
支持通配符

## Field Collapsing

基于字段折叠搜索结果，示例：

```json
GET /twitter/_search
{
    "query": {
        "match": {
            "message": "elasticsearch"
        }
    },
    "collapse" : {
        "field" : "user"
    },
    "sort": ["likes"],
    "from": 10
}
```

以上搜索操作会根据`user`字段去折叠，折叠的hits会根据`likes`数量排序，并显示第10个hit。

**警告** ：响应中的命中总数是未折叠的匹配文档数量。折叠后的组的总数是未知的。

### 展开折叠结果

使用`inner_hits`选项展开每个折叠的顶部命中。

```json
GET /twitter/_search
{
    "query": {
        "match": {
            "message": "elasticsearch"
        }
    },
    "collapse" : {
        "field" : "user", 
        "inner_hits": {
            "name": "last_tweets", 
            "size": 5, 
            "sort": [{ "date": "asc" }] 
        },
        "max_concurrent_group_searches": 4 
    },
    "sort": ["likes"]
}
```

### 第二级折叠

示例：

```json
GET /twitter/_search
{
    "query": {
        "match": {
            "message": "elasticsearch"
        }
    },
    "collapse" : {
        "field" : "country",
        "inner_hits" : {
            "name": "by_location",
            "collapse" : {"field" : "user"},
            "size": 3
        }
    }
}
```